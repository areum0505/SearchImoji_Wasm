<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ê²Œëª¨ì§€? - ì´ëª¨ì§€ ì˜ë¯¸ ê²€ìƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            background: #1e3a8a;
            color: white;
            padding: 20px 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-emoji {
            font-size: 28px;
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 50px 12px 20px;
            font-size: 16px;
            border: none;
            border-radius: 25px;
            background: white;
            color: #333;
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-icon {
            width: 24px;
            height: 24px;
            cursor: pointer;
            opacity: 0.9;
        }

        .header-icon:hover {
            opacity: 1;
        }

        .language-selector {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .language-select {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            outline: none;
            transition: background 0.2s;
        }

        .language-select:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .language-select option {
            background: #1e3a8a;
            color: white;
        }

        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }

        .tab-button {
            padding: 10px 20px;
            border: none;
            background: #e5e7eb;
            cursor: pointer;
            font-size: 15px;
            border-radius: 8px 8px 0 0;
            transition: all 0.2s;
        }

        .tab-button.active {
            background: white;
            color: #1e3a8a;
            font-weight: bold;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 0 8px 8px 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .tab-content.active {
            display: block;
        }

        /* ê²€ìƒ‰ ì…ë ¥ ì˜ì—­ */
        .search-section {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-section input {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .search-section button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: #1e3a8a;
            color: white;
            cursor: pointer;
            transition: background 0.2s;
        }

        .search-section button:hover:not(:disabled) {
            background: #1e40af;
        }

        .search-section button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        #status, #simpleStatus {
            margin-top: 10px;
            color: #3b82f6;
            font-weight: bold;
            font-size: 14px;
        }

        #embeddingTime, #simpleEmbeddingTime {
            margin-top: 5px;
            font-size: 0.9em;
            color: #10b981;
        }

        /* ì´ëª¨ì§€ ê·¸ë¦¬ë“œ ì¹´ë“œ ë ˆì´ì•„ì›ƒ */
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 20px;
        }

        .emoji-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .emoji-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .emoji-character {
            font-size: 48px;
            margin-bottom: 8px;
            display: block;
        }

        .emoji-description {
            font-size: 14px;
            color: #374151;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .emoji-score {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }

        /* ë¹„êµ íƒ­ ìŠ¤íƒ€ì¼ */
        .compare-section {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .compare-column {
            flex: 1;
            background: #f9fafb;
            padding: 15px;
            border-radius: 8px;
        }

        .compare-column h4 {
            margin-bottom: 10px;
            color: #1e3a8a;
        }

        .output-container {
            background: white;
            padding: 15px;
            border-radius: 8px;
            min-height: 200px;
        }

        .emoji-result {
            margin: 5px 0;
            font-size: 1.2em;
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e3a8a;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
            border-radius: 8px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            height: 150px;
            margin-bottom: 16px;
        }

        /* í† ìŠ¤íŠ¸ ì•Œë¦¼ */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1e3a8a;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            display: none;
        }

        .toast.show {
            display: block;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ê²€ìƒ‰ ê²°ê³¼ ì¹´ìš´íŠ¸ */
        .result-count {
            margin: 15px 0;
            color: #6b7280;
            font-size: 14px;
        }

        /* ì´ëª¨ì§€ ì¹´ë“œ ë³µì‚¬ ë²„íŠ¼ */
        .emoji-card {
            position: relative;
        }

        .copy-hint {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
        }

        .emoji-card:hover .copy-hint {
            opacity: 1;
        }

        /* ê²€ìƒ‰ ê²°ê³¼ í˜ì´ë“œì¸ */
        .emoji-card {
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ */
        .search-history {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .history-tag {
            background: #e5e7eb;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .history-tag:hover {
            background: #1e3a8a;
            color: white;
        }

        /* ì¶”ì²œ ê²€ìƒ‰ì–´ */
        .suggestions {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .suggestion-tag {
            background: #dbeafe;
            color: #1e40af;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .suggestion-tag:hover {
            background: #1e40af;
            color: white;
        }

        /* ë¹ˆ ê²°ê³¼ ë©”ì‹œì§€ ê°œì„  */
        .empty-result {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .empty-result-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-result-text {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .empty-result-hint {
            font-size: 14px;
            color: #d1d5db;
        }

        /* ë°˜ì‘í˜• ê°œì„  */
        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .search-container {
                max-width: 100%;
            }

            .emoji-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 12px;
            }

            .compare-section {
                flex-direction: column;
            }
        }

        /* í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ íŒíŠ¸ */
        .keyboard-hint {
            font-size: 11px;
            color: #9ca3af;
            margin-top: 5px;
        }
    </style>
    
    <!-- WASM Module -->
    <script src="./emoji.js"></script>

    <!-- JS ë²„ì „ ê³„ì‚°ê¸° -->
    <script src="./emoji_search_js.js"></script>

    <script>
        window.Module = {
            onRuntimeInitialized: function() {
                document.getElementById('status').innerText = "3/3. WASM ëª¨ë“ˆ ë¡œë”© ì™„ë£Œ.";

                window.WASM_Module = window.Module;

                const searchEmojisWASM = window.WASM_Module.cwrap('search_emojis', 'number', ['number']);
                const freeResultMemoryWASM = window.WASM_Module.cwrap('free_result_memory', null, ['number']);

                if (window.checkReady) window.checkReady();

                // ë¹„êµ íƒ­: WASM vs JS
                document.getElementById('runBtn').addEventListener('click', async () => {
                    const text = document.getElementById('userInput').value.trim();
                    if (!text) return;

                    document.getElementById('status').innerText = "1/3. í…ìŠ¤íŠ¸ ì„ë² ë”© ê³„ì‚° ì¤‘...";
                    const output1Div = document.getElementById('output1');
                    const output2Div = document.getElementById('output2');
                    output1Div.innerHTML = "ê³„ì‚° ì¤‘...";
                    output2Div.innerHTML = "ëŒ€ê¸° ì¤‘...";

                    // í•„ìš”í•œ ëª¨ë¸ ê°€ì ¸ì˜¤ê¸° (ìë™ ì„ íƒ)
                    const extractor = await window.getExtractorForText(text);

                    const t0 = performance.now();
                    const output = await extractor(text, { pooling: 'mean', normalize: true });
                    const vector = Array.from(output.data);
                    const t1 = performance.now();
                    const embeddingTime = t1 - t0;
                    document.getElementById('embeddingTime').innerText = `(ê³µí†µ) í…ìŠ¤íŠ¸ ì„ë² ë”© ì‹œê°„: ${embeddingTime.toFixed(2)} ms`;

                    // ========= 1) WASM ê³„ì‚° =========
                    document.getElementById('status').innerText = "2/3. WASM ê³„ì‚° ì¤‘...";
                    let wasmPtr = 0;
                    let resultPtr = 0;

                    try {
                        wasmPtr = window.WASM_Module._malloc(vector.length * 8);
                        for (let i = 0; i < vector.length; i++) {
                            window.WASM_Module.setValue(wasmPtr + i * 8, vector[i], 'double');
                        }

                        resultPtr = searchEmojisWASM(wasmPtr);
                        const resultJsonString = window.WASM_Module.UTF8ToString(resultPtr);
                        const resultData = JSON.parse(resultJsonString);
                        const wasmResults = resultData.results; 
                        const wasmCallTime = resultData.time_ms; // C++ì—ì„œ ì¸¡ì •ëœ ì‹œê°„

                        let htmlOutput1 = `
                            <div style="font-size: 0.9em; color: #333;">
                                â€¢ WASM ê³„ì‚° ì‹œê°„: <b>${wasmCallTime.toFixed(2)} ms</b>
                            </div><hr>`;
                        htmlOutput1 += formatResults(wasmResults, false);
                        output1Div.innerHTML = htmlOutput1;

                    } catch (error) {
                        console.error("WASM ì‹¤í–‰ ì˜¤ë¥˜:", error);
                        output1Div.innerHTML = `<div style="color:red;">WASM ì‹¤í–‰ ì˜¤ë¥˜: ${error.message}</div>`;
                    } finally {
                        if (wasmPtr) window.WASM_Module._free(wasmPtr);
                        if (resultPtr) freeResultMemoryWASM(resultPtr);
                    }

                    // ========= 2) JavaScript ê³„ì‚° =========
                    document.getElementById('status').innerText = "3/3. JavaScript ê³„ì‚° ì¤‘...";
                    output2Div.innerHTML = "ê³„ì‚° ì¤‘...";

                    const jsResponse = searchEmojisJS(vector); // { results: [], time_ms: N }
                    const jsResults = jsResponse.results;
                    const jsCallTime = jsResponse.time_ms;

                    let htmlOutput2 = `
                        <div style="font-size: 0.9em; color: #333;">
                            â€¢ ìˆœìˆ˜ JS ê³„ì‚° ì‹œê°„: <b>${jsCallTime.toFixed(2)} ms</b>
                        </div><hr>`;
                    htmlOutput2 += formatResults(jsResults, false);
                    output2Div.innerHTML = htmlOutput2;

                    const t = window.translations[window.currentLanguage] || window.translations.ko;
                    document.getElementById('status').innerText = t.compareComplete;
                });

                // ê²€ìƒ‰ í•¨ìˆ˜ (ê³µí†µ)
                async function performSearch(inputText, statusEl, embeddingTimeEl, outputEl) {
                    if (!inputText) return;

                    const t = window.translations[window.currentLanguage] || window.translations.ko;
                    statusEl.innerText = t.calculating;
                    
                    // ì˜ˆì‹œ ì´ëª¨ì§€ ìˆ¨ê¸°ê³  ê²€ìƒ‰ ê²°ê³¼ ì˜ì—­ í‘œì‹œ
                    const exampleEmojis = document.getElementById('exampleEmojis');
                    const searchResults = document.getElementById('searchResults');
                    const emptyState = document.getElementById('emptyState');
                    const resultCount = document.getElementById('resultCount');
                    if (exampleEmojis) exampleEmojis.style.display = 'none';
                    if (emptyState) emptyState.style.display = 'none';
                    if (resultCount) resultCount.style.display = 'none';
                    if (searchResults) {
                        searchResults.style.display = 'block';
                        searchResults.innerHTML = `<div style='text-align: center; padding: 40px;'><div class="spinner"></div><div style='color: #999; margin-top: 10px;'>${t.calculating}</div></div>`;
                    } else {
                        outputEl.innerHTML = `<div style='text-align: center; padding: 40px;'><div class="spinner"></div><div style='color: #999; margin-top: 10px;'>${t.calculating}</div></div>`;
                    }

                    // í•„ìš”í•œ ëª¨ë¸ ê°€ì ¸ì˜¤ê¸° (ìë™ ì„ íƒ)
                    const extractor = await window.getExtractorForText(inputText);

                    const t0 = performance.now();
                    const output = await extractor(inputText, { pooling: 'mean', normalize: true });
                    const vector = Array.from(output.data);
                    const t1 = performance.now();
                    const embeddingTime = t1 - t0;
                    if (embeddingTimeEl) {
                        embeddingTimeEl.innerText = `(ê³µí†µ) í…ìŠ¤íŠ¸ ì„ë² ë”© ì‹œê°„: ${embeddingTime.toFixed(2)} ms`;
                    }

                    const jsResponse = searchEmojisJS(vector);
                    const jsResults = jsResponse.results;

                    const resultsHtml = formatResults(jsResults, true);
                    if (searchResults) {
                        searchResults.innerHTML = resultsHtml;
                        // ê²€ìƒ‰ ê²°ê³¼ ê°œìˆ˜ í‘œì‹œ
                        const resultCount = document.getElementById('resultCount');
                        if (resultCount) {
                            resultCount.style.display = 'block';
                            resultCount.textContent = `ì´ ${jsResults.length}ê°œì˜ ê²°ê³¼ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤`;
                        }
                        // ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
                        addToHistory(inputText);
                    } else if (outputEl) {
                        // outputElì´ ìˆëŠ” ê²½ìš° (ë¹„êµ íƒ­ ë“±)
                        outputEl.innerHTML = resultsHtml;
                    }
                    statusEl.innerText = t.searchComplete;
                }

                // í—¤ë” ê²€ìƒ‰ë°” ì´ë²¤íŠ¸
                const headerSearchInput = document.getElementById('headerSearchInput');
                const headerSearchIcon = headerSearchInput?.nextElementSibling;
                
                const handleHeaderSearch = () => {
                    const text = headerSearchInput.value.trim();
                    if (!text || !window.extractor) return;
                    
                    // ê²€ìƒ‰ íƒ­ìœ¼ë¡œ ì „í™˜
                    const simpleTab = document.querySelector('[data-tab="simple"]');
                    if (simpleTab) {
                        simpleTab.click();
                    }
                    
                    const statusEl = document.getElementById('simpleStatus');
                    const embeddingTimeEl = document.getElementById('simpleEmbeddingTime');
                    const outputEl = document.getElementById('simpleOutput');
                    
                    performSearch(text, statusEl, embeddingTimeEl, outputEl);
                };

                if (headerSearchInput) {
                    headerSearchInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            handleHeaderSearch();
                        }
                    });
                }

                if (headerSearchIcon) {
                    headerSearchIcon.addEventListener('click', handleHeaderSearch);
                }
            }
        };

        function formatResults(results, useGrid = true) {
            if (!results || results.length === 0) {
                return `<div class="empty-result">
                    <div class="empty-result-icon">ğŸ˜•</div>
                    <div class="empty-result-text">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                    <div class="empty-result-hint">ë‹¤ë¥¸ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•´ë³´ì„¸ìš”</div>
                </div>`;
            }
            
            if (useGrid) {
                // ê·¸ë¦¬ë“œ ì¹´ë“œ ë ˆì´ì•„ì›ƒ
                const cards = results.map((item, index) => {
                    const meta = window.emojiMetadata[item.index];
                    if (!meta) return '';
                    
                    // ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¥¼ í¼ì„¼í‹°ì§€ë¡œ ë³€í™˜ (0~1 ë²”ìœ„ë¥¼ 0~100%ë¡œ)
                    const percentage = (item.score * 100).toFixed(1);
                    
                    // ì• ë‹ˆë©”ì´ì…˜ ë”œë ˆì´ ì¶”ê°€
                    const delay = index * 0.05;
                    
                    return `
                        <div class="emoji-card" style="animation-delay: ${delay}s;">
                            <div class="copy-hint">í´ë¦­í•˜ì—¬ ë³µì‚¬</div>
                            <span class="emoji-character">${meta.character}</span>
                            <div class="emoji-description">${meta.description}</div>
                            <div class="emoji-score">${percentage}%</div>
                        </div>
                    `;
                }).filter(card => card !== '').join('');
                
                return `<div class="emoji-grid">${cards}</div>`;
            } else {
                // ë¦¬ìŠ¤íŠ¸ ë ˆì´ì•„ì›ƒ (ë¹„êµ íƒ­ìš©)
                return results.map((item, index) => {
                    const meta = window.emojiMetadata[item.index];
                    if (meta) {
                        const percentage = (item.score * 100).toFixed(1);
                        return `<div class="emoji-result">
                            ${index + 1}. ${meta.character} ${meta.description} 
                            <span style="color: #666;">[${percentage}%]</span>
                        </div>`;
                    }
                    return '';
                }).join('');
            }
        }
    </script>

    <script src="./emoji_search.js"></script>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-emoji">ğŸ”</span>
                <span>ì´ê²Œëª¨ì§€?</span>
            </div>
            <div class="search-container">
                <input type="text" id="headerSearchInput" class="search-input" placeholder="ì´ëª¨í‹°ì½˜ ê²€ìƒ‰...">
                <svg class="search-icon" fill="none" stroke="#666" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <div class="keyboard-hint" style="position: absolute; bottom: -20px; left: 20px; font-size: 11px; color: rgba(255,255,255,0.7);">
                    Enterë¡œ ê²€ìƒ‰
                </div>
            </div>
            <div class="header-actions">
                <div class="language-selector">
                    <svg class="header-icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" style="width: 20px; height: 20px;">
                        <path fill-rule="evenodd" d="M7 2a1 1 0 011 1v1h3a1 1 0 110 2H9.578a18.87 18.87 0 01-1.724 2.258c-.29.354-.596.696-.914 1.022a1 1 0 11-1.44-1.389c.314-.314.612-.653.9-1.004A16.979 16.979 0 017 6V3a1 1 0 011-1zm6 0a1 1 0 011 1v1a16.98 16.98 0 011.288 2.258c.29.354.596.696.914 1.022a1 1 0 11-1.44 1.389c-.314-.314-.612-.653-.9-1.004A18.87 18.87 0 0111.578 6H10a1 1 0 110-2h1V3a1 1 0 011-1zM2 9a1 1 0 011-1h.01a1 1 0 110 2H3a1 1 0 01-1-1zm15 0a1 1 0 011-1h.01a1 1 0 110 2H18a1 1 0 01-1-1zm-6 0a1 1 0 011-1h.01a1 1 0 110 2H12a1 1 0 01-1-1zM7 13a1 1 0 011-1h.01a1 1 0 110 2H8a1 1 0 01-1-1zm6 0a1 1 0 011-1h.01a1 1 0 110 2H14a1 1 0 01-1-1zm-3 0a1 1 0 011-1h.01a1 1 0 110 2H12a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <select id="languageSelect" class="language-select">
                        <option value="auto">í†µí•© (ìë™)</option>
                        <option value="ko">í•œêµ­ì–´</option>
                        <option value="en">English</option>
                    </select>
                </div>
                <svg class="header-icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 15a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                </svg>
                <svg class="header-icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                </svg>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="main-container">
        <div class="tabs">
            <button class="tab-button active" data-tab="simple">ê²€ìƒ‰ë§Œ í•˜ê¸°</button>
            <button class="tab-button" data-tab="compare">WASM vs JS ë¹„êµ</button>
        </div>

        <!-- ê²€ìƒ‰ ì „ìš© íƒ­ -->
        <div id="tab-simple" class="tab-content active">
            <div id="simpleStatus" style="margin-top: 10px; color: blue; font-weight: bold;">
                ì´ˆê¸°í™” ì‹œì‘: ë©”íƒ€ë°ì´í„° ë¡œë”© (1/3), ëª¨ë¸ ë¡œë”© (2/3)
            </div>
            <div id="simpleEmbeddingTime" style="margin-top: 10px; font-size: 0.9em; color: green;"></div>

            <div id="simpleOutput" style="margin-top: 20px;">
                <div id="resultCount" class="result-count" style="display: none;"></div>
                <div id="exampleEmojis" class="emoji-grid" style="display: none;">
                    <!-- ì˜ˆì‹œ ì´ëª¨ì§€ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                <div id="searchResults" style="display: none;"></div>
                <div id="emptyState" style="text-align: center; padding: 40px; color: #999;">
                    <div class="empty-result">
                        <div class="empty-result-icon">ğŸ”</div>
                        <div class="empty-result-text">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
                        <div class="empty-result-hint">ìœ„ ê²€ìƒ‰ì°½ì—ì„œ ì´ëª¨ì§€ë¥¼ ê²€ìƒ‰í•´ë³´ì„¸ìš”</div>
                    </div>
                </div>
            </div>
            <div id="searchHistory" class="search-history" style="display: none;"></div>
            <div id="suggestions" class="suggestions"></div>
        </div>

    <!-- WASM vs JS ë¹„êµ íƒ­ -->
    <div id="tab-compare" class="tab-content">
        <p style="margin-bottom: 15px; color: #6b7280;">ë™ì¼í•œ ë¬¸ì¥ ì„ë² ë”©ì„ ì´ìš©í•˜ì—¬ WASMê³¼ JavaScript ê³„ì‚° ì†ë„ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.</p>

        <div class="search-section">
        <input type="text" id="userInput" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
        <button id="runBtn" disabled>ë¹„êµ ì‹¤í–‰</button>
    </div>

    <div id="status">ì´ˆê¸°í™” ì‹œì‘: ë©”íƒ€ë°ì´í„° ë¡œë”© (1/3), ëª¨ë¸ ë¡œë”© (2/3)</div>
        <div id="embeddingTime"></div>

        <div class="compare-section">
            <div class="compare-column">
            <h4>WASM ê³„ì‚° ê²°ê³¼</h4>
            <div id="output1" class="output-container">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
        </div>
            <div class="compare-column">
            <h4>JavaScript ê³„ì‚° ê²°ê³¼</h4>
            <div id="output2" class="output-container">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
            </div>
        </div>
    </div>

    <script>
        // ì–¸ì–´ë³„ í…ìŠ¤íŠ¸ ì •ì˜
        const translations = {
            ko: {
                searchPlaceholder: "ì´ëª¨í‹°ì½˜ ê²€ìƒ‰...",
                tabSimple: "ê²€ìƒ‰ë§Œ í•˜ê¸°",
                tabCompare: "WASM vs JS ë¹„êµ",
                emptyState: "ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.",
                compareDescription: "ë™ì¼í•œ ë¬¸ì¥ ì„ë² ë”©ì„ ì´ìš©í•˜ì—¬ WASMê³¼ JavaScript ê³„ì‚° ì†ë„ë¥¼ ë¹„êµí•©ë‹ˆë‹¤.",
                userInputPlaceholder: "ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”...",
                compareButton: "ë¹„êµ ì‹¤í–‰",
                wasmResult: "WASM ê³„ì‚° ê²°ê³¼",
                jsResult: "JavaScript ê³„ì‚° ê²°ê³¼",
                loadingMetadata: "ì´ˆê¸°í™” ì‹œì‘: ë©”íƒ€ë°ì´í„° ë¡œë”© (1/3), ëª¨ë¸ ë¡œë”© (2/3)",
                ready: "ëª¨ë“  ì¤€ë¹„ ì™„ë£Œ!",
                searchAvailable: "ê°œ ì´ëª¨ì§€ ê²€ìƒ‰ ê°€ëŠ¥",
                calculating: "ê³„ì‚° ì¤‘...",
                searchComplete: "ê²€ìƒ‰ ì™„ë£Œ!",
                compareComplete: "ë¹„êµ ì™„ë£Œ!"
            },
            en: {
                searchPlaceholder: "Search emoji...",
                tabSimple: "Search Only",
                tabCompare: "WASM vs JS Compare",
                emptyState: "Search results will be displayed here.",
                compareDescription: "Compare WASM and JavaScript calculation speeds using the same sentence embedding.",
                userInputPlaceholder: "Enter search term...",
                compareButton: "Run Compare",
                wasmResult: "WASM Calculation Result",
                jsResult: "JavaScript Calculation Result",
                loadingMetadata: "Initialization: Loading metadata (1/3), Loading model (2/3)",
                ready: "All ready!",
                searchAvailable: " emojis available for search",
                calculating: "Calculating...",
                searchComplete: "Search complete!",
                compareComplete: "Compare complete!"
            }
        };

        // ëª¨ë¸ ë§¤í•‘
        const modelMap = {
            'ko': 'Xenova/paraphrase-multilingual-mpnet-base-v2',  // í•œêµ­ì–´: ë‹¤êµ­ì–´ ëª¨ë¸
            'en': 'Xenova/all-mpnet-base-v2'                        // ì˜ì–´: ì˜ì–´ ì „ìš© ëª¨ë¸
        };

        // ì–¸ì–´ ê°ì§€ í•¨ìˆ˜ (ê°„ë‹¨í•œ íœ´ë¦¬ìŠ¤í‹±)
        function detectLanguage(text) {
            if (!text || text.trim().length === 0) return 'en';
            
            // í•œê¸€ ìœ ë‹ˆì½”ë“œ ë²”ìœ„: AC00-D7AF
            const koreanRegex = /[ê°€-í£]/;
            // ì˜ì–´ ì•ŒíŒŒë²³
            const englishRegex = /[a-zA-Z]/;
            
            let koreanCount = 0;
            let englishCount = 0;
            
            for (let char of text) {
                if (koreanRegex.test(char)) {
                    koreanCount++;
                } else if (englishRegex.test(char)) {
                    englishCount++;
                }
            }
            
            // í•œê¸€ì´ ë” ë§ìœ¼ë©´ í•œêµ­ì–´, ì•„ë‹ˆë©´ ì˜ì–´
            return koreanCount > englishCount ? 'ko' : 'en';
        }

        // í˜„ì¬ ì–¸ì–´ (ê¸°ë³¸ê°’: í•œêµ­ì–´) - ì „ì—­ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡
        window.currentLanguage = 'ko';
        window.translations = translations;

        // ì–¸ì–´ ë³€ê²½ í•¨ìˆ˜
        function changeLanguage(lang) {
            // 'auto'ëŠ” UI ì–¸ì–´ë§Œ ë³€ê²½í•˜ê³ , ëª¨ë¸ì€ ê²€ìƒ‰ ì‹œ ìë™ ì„ íƒ
            if (lang === 'auto') {
                // ê¸°ë³¸ UI ì–¸ì–´ëŠ” í•œêµ­ì–´
                window.currentLanguage = 'ko';
                window.selectedLanguageMode = 'auto';
            } else {
                window.currentLanguage = lang;
                window.selectedLanguageMode = lang;
            }
            const t = translations[window.currentLanguage] || translations.ko;

            // í—¤ë” ê²€ìƒ‰ë°” placeholder
            const headerSearchInput = document.getElementById('headerSearchInput');
            if (headerSearchInput) {
                headerSearchInput.placeholder = t.searchPlaceholder;
            }

            // íƒ­ ë²„íŠ¼
            const tabButtons = document.querySelectorAll('.tab-button');
            if (tabButtons.length >= 2) {
                tabButtons[0].textContent = t.tabSimple;
                tabButtons[1].textContent = t.tabCompare;
            }

            // ë¹ˆ ìƒíƒœ ë©”ì‹œì§€
            const emptyState = document.getElementById('emptyState');
            if (emptyState) {
                emptyState.textContent = t.emptyState;
            }

            // ë¹„êµ íƒ­ ì„¤ëª…
            const compareDesc = document.querySelector('#tab-compare p');
            if (compareDesc) {
                compareDesc.textContent = t.compareDescription;
            }

            // ë¹„êµ íƒ­ ì…ë ¥ í•„ë“œ
            const userInput = document.getElementById('userInput');
            if (userInput) {
                userInput.placeholder = t.userInputPlaceholder;
            }

            // ë¹„êµ ë²„íŠ¼
            const runBtn = document.getElementById('runBtn');
            if (runBtn) {
                runBtn.textContent = t.compareButton;
            }

            // ê²°ê³¼ ì œëª©
            const wasmResultTitle = document.querySelector('.compare-column h4');
            const jsResultTitle = document.querySelectorAll('.compare-column h4');
            if (jsResultTitle.length >= 2) {
                jsResultTitle[0].textContent = t.wasmResult;
                jsResultTitle[1].textContent = t.jsResult;
            }

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            localStorage.setItem('preferredLanguage', lang);
        }

        // ì–¸ì–´ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì´ë²¤íŠ¸
        document.addEventListener('DOMContentLoaded', () => {
            // ì €ì¥ëœ ì–¸ì–´ ì„¤ì • ë¶ˆëŸ¬ì˜¤ê¸°
            const savedLang = localStorage.getItem('preferredLanguage') || 'auto';
            const languageSelect = document.getElementById('languageSelect');
            if (languageSelect) {
                languageSelect.value = savedLang;
                window.selectedLanguageMode = savedLang;
                changeLanguage(savedLang);

                languageSelect.addEventListener('change', (e) => {
                    changeLanguage(e.target.value);
                });
            }

            // íƒ­ ì „í™˜ ë¡œì§
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');

            tabButtons.forEach((btn) => {
                btn.addEventListener('click', () => {
                    const target = btn.getAttribute('data-tab');

                    tabButtons.forEach(b => b.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));

                    btn.classList.add('active');
                    const targetContent = document.getElementById(`tab-${target}`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });
        });
    </script>

    <script type="module">
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.14.0';
        env.allowLocalModels = false;

        window.emojiMetadata = [];
        window.extractor = null;
        window.EMBEDDINGS = EMBEDDINGS;

        const statusDiv = document.getElementById('status');
        const runBtn = document.getElementById('runBtn');
        const simpleStatusDiv = document.getElementById('simpleStatus');
        const simpleBtn = document.getElementById('simpleBtn');
        const CSV_FILE_PATH = './emoji.csv';

        // ì˜ˆì‹œ ì´ëª¨ì§€ í‘œì‹œ í•¨ìˆ˜
        function showExampleEmojis() {
            const exampleEmojisDiv = document.getElementById('exampleEmojis');
            const emptyState = document.getElementById('emptyState');
            
            if (!exampleEmojisDiv || !window.emojiMetadata || window.emojiMetadata.length === 0) {
                return;
            }

            // ë‹¤ì–‘í•œ ì¹´í…Œê³ ë¦¬ì˜ ì¸ê¸° ì´ëª¨ì§€ ì¸ë±ìŠ¤ (24ê°œ ì„ íƒ)
            // ì²˜ìŒë¶€í„° ì¼ì • ê°„ê²©ìœ¼ë¡œ ì„ íƒí•˜ì—¬ ë‹¤ì–‘í•œ ì´ëª¨ì§€ í‘œì‹œ
            const totalEmojis = window.emojiMetadata.length;
            const numExamples = Math.min(24, totalEmojis);
            const step = Math.floor(totalEmojis / numExamples);
            
            const exampleIndices = [];
            for (let i = 0; i < numExamples; i++) {
                const idx = i * step;
                if (idx < totalEmojis) {
                    exampleIndices.push(idx);
                }
            }
            
            // ì¶”ê°€ë¡œ ëœë¤í•˜ê²Œ ëª‡ ê°œ ë” ì„ íƒ
            const remaining = numExamples - exampleIndices.length;
            for (let i = 0; i < remaining && exampleIndices.length < numExamples; i++) {
                const randomIdx = Math.floor(Math.random() * totalEmojis);
                if (!exampleIndices.includes(randomIdx)) {
                    exampleIndices.push(randomIdx);
                }
            }

            const exampleCards = exampleIndices.map((idx) => {
                const meta = window.emojiMetadata[idx];
                if (!meta) return '';
                
                return `
                    <div class="emoji-card">
                        <span class="emoji-character">${meta.character}</span>
                        <div class="emoji-description">${meta.description}</div>
                    </div>
                `;
            }).filter(card => card !== '').join('');

            if (exampleCards) {
                exampleEmojisDiv.innerHTML = exampleCards;
                exampleEmojisDiv.style.display = 'grid';
                if (emptyState) emptyState.style.display = 'none';
            }
        }

        window.checkReady = function() {
            if (
                window.extractor &&
                window.WASM_Module &&
                window.emojiMetadata.length > 0 &&
                window.EMBEDDINGS &&
                window.EMBEDDINGS.length > 0
            ) {
                const t = window.translations[window.currentLanguage] || window.translations.ko;
                statusDiv.innerText = `${t.ready} ${window.emojiMetadata.length}${t.searchAvailable}`;
                statusDiv.style.color = "green";
                runBtn.disabled = false;
                if (simpleStatusDiv) {
                    simpleStatusDiv.innerText = `${t.ready} ${window.emojiMetadata.length}${t.searchAvailable}`;
                    simpleStatusDiv.style.color = "green";
                }
                if (simpleBtn) {
                    simpleBtn.disabled = false;
                }
                
                // ì˜ˆì‹œ ì´ëª¨ì§€ í‘œì‹œ
                showExampleEmojis();
            }
        };

        async function loadEmojiMetadata(filepath) {
            try {
                const response = await fetch(filepath);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const csvText = await response.text();
                
                const lines = csvText.trim().split('\n');
                const data = lines.map(line => {
                    const parts = line.match(/(?:[^\s,"]+|"(?:\\.|[^"])*")+/g);
                    if (!parts || parts.length < 2) return null;
                    const character = parts[0].trim();
                    const description = parts[1].replace(/"/g, '').trim();
                    return { character, description };
                }).filter(item => item !== null);
                
                window.emojiMetadata = data;
                // ì–¸ì–´ë³„ ë©”ì‹œì§€ëŠ” ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ë¯€ë¡œ ê¸°ë³¸ ë©”ì‹œì§€ ìœ ì§€
                statusDiv.innerText = `1/3. ë©”íƒ€ë°ì´í„° ë¡œë“œ ì™„ë£Œ (${data.length}ê°œ)`;
                // ë©”íƒ€ë°ì´í„° ë¡œë“œ í›„ ì¶”ì²œì–´ ì—…ë°ì´íŠ¸
                if (window.updateSuggestions) {
                    window.updateSuggestions();
                }
            } catch (err) {
                statusDiv.innerText = `ì˜¤ë¥˜ (1/3): CSV ë¡œë“œ ì‹¤íŒ¨ (${err.message})`;
                statusDiv.style.color = "red";
                throw err;
            }
        }

        // ëª¨ë¸ ë¡œë“œ í•¨ìˆ˜
        async function loadTransformerModel(modelName) {
            try {
                statusDiv.innerText = "2/3. ì„ë² ë”© ëª¨ë¸ ë¡œë“œ ì¤‘...";
                window.extractor = await pipeline('feature-extraction', modelName);
                window.currentModel = modelName;
                statusDiv.innerText = "2/3. ì„ë² ë”© ëª¨ë¸ ë¡œë”© ì™„ë£Œ";
            } catch (err) {
                statusDiv.innerText = `ì˜¤ë¥˜ (2/3): ëª¨ë¸ ë¡œë“œ ì‹¤íŒ¨ (${err.message})`;
                statusDiv.style.color = "red";
                throw err;
            }
        }

        // ê²€ìƒ‰ì— í•„ìš”í•œ ëª¨ë¸ ê°€ì ¸ì˜¤ê¸° (í•„ìš”ì‹œ ë¡œë“œ) - ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
        window.getExtractorForText = async function(text) {
            // ì–¸ì–´ ëª¨ë“œ í™•ì¸
            const mode = window.selectedLanguageMode || 'auto';
            let targetLang = mode;
            
            // ìë™ ëª¨ë“œë©´ ì–¸ì–´ ê°ì§€
            if (mode === 'auto') {
                targetLang = detectLanguage(text);
            }
            
            const requiredModel = modelMap[targetLang] || modelMap['en'];
            
            // í˜„ì¬ ëª¨ë¸ì´ í•„ìš”í•œ ëª¨ë¸ê³¼ ë‹¤ë¥´ë©´ ë¡œë“œ
            if (!window.extractor || window.currentModel !== requiredModel) {
                const statusDiv = document.getElementById('status');
                const simpleStatusDiv = document.getElementById('simpleStatus');
                const statusEl = simpleStatusDiv || statusDiv;
                
                if (statusEl) {
                    statusEl.innerText = `ëª¨ë¸ ë¡œë“œ ì¤‘... (${targetLang === 'ko' ? 'ë‹¤êµ­ì–´' : 'ì˜ì–´'} ëª¨ë¸)`;
                    statusEl.style.color = "blue";
                }
                
                await loadTransformerModel(requiredModel);
                
                if (statusEl) {
                    statusEl.style.color = "green";
                }
            }
            
            return window.extractor;
        };

        (async () => {
            try {
                statusDiv.innerText = "1/3. ì´ëª¨ì§€ ë©”íƒ€ë°ì´í„° ë¡œë“œ ì¤‘...";
                await loadEmojiMetadata(CSV_FILE_PATH);

                statusDiv.innerText = "2/3. ì„ë² ë”© ëª¨ë¸ ë¡œë“œ ì¤‘...";
                // ì´ˆê¸° ëª¨ë¸ì€ ë‹¤êµ­ì–´ ëª¨ë¸ë¡œ ë¡œë“œ (í•œêµ­ì–´ ì§€ì›)
                await loadTransformerModel(modelMap['ko']);

                window.checkReady();

            } catch (err) {
                console.error("ì´ˆê¸°í™” ì˜¤ë¥˜:", err);
            }
        })();
    </script>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div id="toast" class="toast"></div>

    <script>
        // í† ìŠ¤íŠ¸ ì•Œë¦¼ í‘œì‹œ
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // í´ë¦½ë³´ë“œ ë³µì‚¬
        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                showToast(`ë³µì‚¬ë¨: ${text}`);
            } catch (err) {
                // í´ë°±: í…ìŠ¤íŠ¸ ì˜ì—­ ì‚¬ìš©
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    showToast(`ë³µì‚¬ë¨: ${text}`);
                } catch (e) {
                    showToast('ë³µì‚¬ ì‹¤íŒ¨');
                }
                document.body.removeChild(textArea);
            }
        }

        // ê²€ìƒ‰ íˆìŠ¤í† ë¦¬ ê´€ë¦¬
        const searchHistory = JSON.parse(localStorage.getItem('emojiSearchHistory') || '[]');
        const maxHistory = 10;

        function addToHistory(query) {
            if (!query || query.trim().length === 0) return;
            
            // ì¤‘ë³µ ì œê±°
            const index = searchHistory.indexOf(query);
            if (index > -1) {
                searchHistory.splice(index, 1);
            }
            
            // ì•ì— ì¶”ê°€
            searchHistory.unshift(query);
            
            // ìµœëŒ€ ê°œìˆ˜ ì œí•œ
            if (searchHistory.length > maxHistory) {
                searchHistory.pop();
            }
            
            localStorage.setItem('emojiSearchHistory', JSON.stringify(searchHistory));
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyDiv = document.getElementById('searchHistory');
            if (!historyDiv) return;
            
            if (searchHistory.length === 0) {
                historyDiv.style.display = 'none';
                return;
            }
            
            historyDiv.style.display = 'flex';
            historyDiv.innerHTML = '<span style="font-size: 12px; color: #6b7280; margin-right: 8px;">ìµœê·¼ ê²€ìƒ‰:</span>' +
                searchHistory.slice(0, 5).map(query => 
                    `<span class="history-tag" onclick="document.getElementById('headerSearchInput').value='${query}'; document.querySelector('.search-icon').click();">${query}</span>`
                ).join('');
        }

        // ì¶”ì²œ ê²€ìƒ‰ì–´ ìƒì„± í•¨ìˆ˜ (ì´ëª¨ì§€ ë©”íƒ€ë°ì´í„° ê¸°ë°˜)
        function generateSuggestionsFromMetadata() {
            if (!window.emojiMetadata || window.emojiMetadata.length === 0) {
                // í´ë°±: ê¸°ë³¸ ì¶”ì²œì–´
                return {
                    ko: ['í–‰ë³µí•œ', 'ìŠ¬í”ˆ', 'ìŒì‹', 'ë™ë¬¼', 'ì‚¬ë‘', 'ì¶•í•˜', 'ê°ì‚¬', 'ì¸ì‚¬'],
                    en: ['happy', 'sad', 'food', 'animal', 'love', 'celebration', 'thanks', 'greeting']
                };
            }

            // ì´ëª¨ì§€ ì„¤ëª…ì—ì„œ í‚¤ì›Œë“œ ì¶”ì¶œ
            const keywordCount = {};
            const commonWords = new Set(['ì˜', 'ì„', 'ë¥¼', 'ì´', 'ê°€', 'ëŠ”', 'ì€', 'ì—', 'ì—ì„œ', 'ì™€', 'ê³¼', 'ë¡œ', 'ìœ¼ë¡œ', 'the', 'a', 'an', 'is', 'are', 'and', 'or', 'of', 'in', 'on', 'at', 'to', 'for']);
            
            window.emojiMetadata.forEach(meta => {
                if (!meta.description) return;
                
                // ì„¤ëª…ì„ ë‹¨ì–´ë¡œ ë¶„ë¦¬
                const words = meta.description.toLowerCase()
                    .replace(/[^\w\sê°€-í£]/g, ' ') // íŠ¹ìˆ˜ë¬¸ì ì œê±°
                    .split(/\s+/)
                    .filter(word => word.length > 1 && !commonWords.has(word));
                
                words.forEach(word => {
                    keywordCount[word] = (keywordCount[word] || 0) + 1;
                });
            });

            // ë¹ˆë„ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedKeywords = Object.entries(keywordCount)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 30)
                .map(([word]) => word);

            // ì–¸ì–´ë³„ë¡œ ë¶„ë¥˜
            const koKeywords = sortedKeywords.filter(w => /[ê°€-í£]/.test(w)).slice(0, 8);
            const enKeywords = sortedKeywords.filter(w => /[a-zA-Z]/.test(w)).slice(0, 8);

            return {
                ko: koKeywords.length > 0 ? koKeywords : ['í–‰ë³µí•œ', 'ìŠ¬í”ˆ', 'ìŒì‹', 'ë™ë¬¼', 'ì‚¬ë‘', 'ì¶•í•˜', 'ê°ì‚¬', 'ì¸ì‚¬'],
                en: enKeywords.length > 0 ? enKeywords : ['happy', 'sad', 'food', 'animal', 'love', 'celebration', 'thanks', 'greeting']
            };
        }

        function updateSuggestions() {
            const suggestionsDiv = document.getElementById('suggestions');
            if (!suggestionsDiv) return;
            
            const lang = window.currentLanguage || 'ko';
            
            // ì´ëª¨ì§€ ë©”íƒ€ë°ì´í„°ì—ì„œ ì¶”ì²œì–´ ìƒì„±
            const suggestions = generateSuggestionsFromMetadata();
            const langSuggestions = lang === 'ko' ? suggestions.ko : suggestions.en;
            
            if (langSuggestions.length === 0) {
                suggestionsDiv.innerHTML = '';
                return;
            }
            
            suggestionsDiv.innerHTML = '<span style="font-size: 12px; color: #6b7280; margin-right: 8px;">ì¶”ì²œ:</span>' +
                langSuggestions.slice(0, 6).map(s => 
                    `<span class="suggestion-tag" onclick="document.getElementById('headerSearchInput').value='${s}'; document.querySelector('.search-icon').click();">${s}</span>`
                ).join('');
        }

        // ì´ëª¨ì§€ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        document.addEventListener('click', (e) => {
            const card = e.target.closest('.emoji-card');
            if (card) {
                const emoji = card.querySelector('.emoji-character')?.textContent;
                if (emoji) {
                    copyToClipboard(emoji);
                }
            }
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', (e) => {
            // Enterë¡œ ê²€ìƒ‰
            if (e.key === 'Enter' && (e.target.id === 'headerSearchInput' || e.target.id === 'userInput')) {
                e.preventDefault();
                if (e.target.id === 'headerSearchInput') {
                    document.querySelector('.search-icon')?.click();
                } else {
                    document.getElementById('runBtn')?.click();
                }
            }
            
            // ESCë¡œ ì´ˆê¸°í™”
            if (e.key === 'Escape' && document.activeElement.tagName === 'INPUT') {
                document.activeElement.value = '';
                document.activeElement.blur();
            }
        });

        // ì¶”ì²œì–´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë¥¼ ì „ì—­ìœ¼ë¡œ ë…¸ì¶œ
        window.updateSuggestions = updateSuggestions;

        // ì´ˆê¸°í™” ì‹œ íˆìŠ¤í† ë¦¬ì™€ ì¶”ì²œì–´ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', () => {
            updateHistoryDisplay();
            // ë©”íƒ€ë°ì´í„°ê°€ ë¡œë“œë˜ë©´ updateSuggestionsê°€ í˜¸ì¶œë¨
            // ì—¬ê¸°ì„œëŠ” ë¹ˆ ìƒíƒœë¡œ ì‹œì‘
        });

        // ê²€ìƒ‰ í•¨ìˆ˜ ìˆ˜ì • - íˆìŠ¤í† ë¦¬ ì¶”ê°€
        const originalPerformSearch = window.Module?.onRuntimeInitialized;
        if (originalPerformSearch) {
            // ê²€ìƒ‰ ì„±ê³µ ì‹œ íˆìŠ¤í† ë¦¬ì— ì¶”ê°€í•˜ë„ë¡ ìˆ˜ì •
            // ì´ ë¶€ë¶„ì€ performSearch í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ ì²˜ë¦¬
        }
    </script>
</body>
</html>
